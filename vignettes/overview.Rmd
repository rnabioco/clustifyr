---
title: 'RClusterCT overview'
date: '`r Sys.Date()`'
output:
  rmarkdown::html_vignette:
    toc: true
    toc_depth: 3
    vignette: >
      %\VignetteIndexEntry{rclusterct-overview}
      %\VignetteEngine{knitr::rmarkdown}
      %\VignetteEncoding{UTF-8}
---

```{r knitr_opts, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center"
)
```

```{r init, echo = FALSE, message = FALSE}
library(RClusterCT)
library(ggplot2)
library(Matrix)
```

## Why use RClusterCT?

## Simple Example

```{r}
# load pacakge data
data("pbmc4k_matrix")
data("pbmc4k_meta")
data("pbmc4k_vargenes")
data("pbmc_bulk_matrix")

# run correlation 
res <- run_cor(pbmc4k_matrix,
        pbmc4k_meta,
        pbmc_bulk_matrix,
        pbmc4k_vargenes,
        if_permute = F,
        compute_method = corr_coef)

res[1:10, 1:10]
```

### Plot cluster identities and correlation coefficients

```{r plot, fig.height=8, fig.width=12}
# plot tsne using known identities
plot_tsne(pbmc4k_meta, feature = "classified")

# plot correlation coefficients on tsne for each identity class
plot_cor(res,
         pbmc4k_meta,
         colnames(res)[1:7])


```

### Obtain p-value for similarity using a permutation test

We can also calcualte correlation p-values using permutation with the `run_cor()` function.

```{r}
res <- run_cor(pbmc4k_matrix,
               pbmc4k_meta,
               pbmc_bulk_matrix,
                pbmc4k_vargenes,
               if_permute = TRUE,
               num_permute=1000,
               metadata = "classified",
               compute_method = corr_coef,
               return_full = TRUE)

res$p_val[1:10, 1:10]
```

